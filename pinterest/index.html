<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>瀑布流效果实现</title>
<style>
*{margin:0;padding:0;}
#pin-box{
    position: relative;
}
#pin-box .item{
    float: left;
    width: 220px;
    margin: 5px;
}
#pin-box img{
    width: 200px;
    padding: 9px;
    border: 1px solid #ddd;
    border-radius: 5px;
    /*box-shadow: 0 0 6px #ddd;*/
}
</style>
</head>
<body>
<div class="wrapper">
    <div id="pin-box">
        <a class="item" href="#"><img src="img/1.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/2.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/3.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/4.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/5.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/6.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/7.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/8.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/9.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/10.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/1.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/2.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/3.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/4.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/5.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/6.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/7.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/8.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/9.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/10.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/1.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/2.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/3.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/4.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/5.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/6.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/7.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/8.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/9.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/10.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/1.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/2.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/3.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/4.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/5.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/6.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/7.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/8.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/9.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/10.jpg" alt=""></a>
    </div>
</div>
<script>
window.onload = function(){
    var oBox = document.getElementById('pin-box');
    var aItem = getByClass(oBox, 'item');

    var itemWidth = aItem[0].offsetWidth;

    //浏览器视口宽高
    var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    var h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
    var num = Math.floor(w / itemWidth);
    var tmpW = num * (itemWidth+10) + 'px';
    oBox.style.cssText += ";width:" + tmpW + ";margin:0 auto;";

    var colHeights = [];
    for(var i=0, len=aItem.length; i<len; i++){
        if(i<num){
            colHeights.push(aItem[i].offsetHeight + 10);
        }else{
            var mHeight = Math.min.apply({}, colHeights);
            var mIndex = getMinIndex(colHeights, mHeight);

            aItem[i].style.cssText = 'position:absolute;left:' + (aItem[mIndex].offsetLeft - 5) + 'px;top:' + mHeight + 'px;';
            colHeights[mIndex] += (aItem[i].offsetHeight + 10);
        }
    }

    /*var mHeight = Math.min.apply({}, colHeights);
    var mIndex = getMinIndex(colHeights, mHeight);


    aItem[num].style.cssText = 'position:absolute;left:' + (aItem[mIndex].offsetLeft - 5) + 'px;top:' + mHeight + 'px;';
    colHeights[mIndex] += aItem[num].offsetHeight + 10;*/

    //console.log(mHeight + "," + mIndex);
    window.onscroll = function(){
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        var tHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
        if(tHeight <= h + scrollTop){
            console.log('滚动条到达底部');
            var oA = document.createElement('a');
            var oImg = document.createElement('img');
            oA.className = 'item';
            oA.href = 'http://baidu.com';
            oImg.src="img/10.jpg";
            oA.appendChild(oImg);

            var newMinH = Math.min.apply({}, colHeights);
            var newMinI = getMinIndex(colHeights, newMinH);

            oA.style.cssText = 'position:absolute;left:' + (aItem[newMinI].offsetLeft - 5) + 'px;top:' + newMinH + 'px;';

            oBox.appendChild(oA);
            colHeights[newMinI] += (oA.offsetHeight + 10);
        }
    }
}


function loadImg(items, target){
    target.appendChild(items);
}

function getMinIndex(arr, minHeight){
    for(index in arr){
        if(arr[index] == minHeight)
            return index;
    }
}
function getByClass(parent, className){
    var arr = [];
    var p = parent || document;
    var aElem = p.getElementsByTagName('*');
    for(var i=0, len=aElem.length; i<len; i++){
        if(hasClass(aElem[i], className)){
            arr.push(aElem[i]);
        }
    }
    return arr;
}
function hasClass(elem, className){
    var patt = new RegExp('\\s+' + className + '|' + className + '\\s+' + '|' + className);
    return patt.test(elem.className);
}

</script>
</body>
</html>