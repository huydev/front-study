<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>瀑布流效果实现</title>
<style>
*{margin:0;padding:0;}
#pin-box{
    position: relative;
}
#pin-box .item{
    float: left;
    width: 220px;
    margin: 5px;
}
#pin-box img{
    width: 200px;
    padding: 9px;
    border: 1px solid #ddd;
    border-radius: 5px;
    /*box-shadow: 0 0 6px #ddd;*/
}
</style>
</head>
<body>
<div class="wrapper">
    <div id="pin-box">
        <a class="item" href="#"><img src="img/1.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/2.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/3.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/4.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/5.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/6.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/7.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/8.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/9.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/10.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/1.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/2.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/3.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/4.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/5.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/6.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/7.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/8.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/9.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/10.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/1.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/2.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/3.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/4.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/5.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/6.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/7.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/8.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/9.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/10.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/1.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/2.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/3.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/4.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/5.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/6.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/7.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/8.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/9.jpg" alt=""></a>
        <a class="item" href="#"><img src="img/10.jpg" alt=""></a>
    </div>
</div>
<script>
window.onload = function(){
    var oBox = document.getElementById('pin-box');
    initGallery(oBox, 'item');

    window.onscroll = function(){
        scrollLoad(oBox, 'item');
        /*var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        var tHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
        if(tHeight <= h + scrollTop){
            console.log('滚动条到达底部');
            var oA = document.createElement('a');
            var oImg = document.createElement('img');
            oA.className = 'item';
            oA.href = 'http://baidu.com';
            oImg.src="img/10.jpg";
            oA.appendChild(oImg);

            var newMinH = Math.min.apply({}, colHeights);
            var newMinI = getMinIndex(colHeights, newMinH);

            oA.style.cssText = 'position:absolute;left:' + (aItem[newMinI].offsetLeft - 5) + 'px;top:' + newMinH + 'px;';

            oBox.appendChild(oA);
            colHeights[newMinI] += (oA.offsetHeight + 10);
        }*/
    }
}

function scrollLoad(parent, className){
    var aItems = getByClass(parent, className);
    var len = aItems.length;
    var h = aItems[len-1].offsetTop + Math.floor(aItems[len-1].offsetHeight / 2);   //加载的临界条件
    var clientH = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
    var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;

    /*
    ** 模拟数据
    **
    */
    var data = [
        {"src":"img/1.jpg"},
        {"src":"img/2.jpg"},
        {"src":"img/3.jpg"},
        {"src":"img/4.jpg"},
        {"src":"img/5.jpg"},
        {"src":"img/6.jpg"},
        {"src":"img/7.jpg"},
        {"src":"img/8.jpg"},
        {"src":"img/9.jpg"},
        {"src":"img/10.jpg"}
    ];

    if(h < clientH + scrollTop){
        for(var i=0, len=data.length; i<len; i++){
            var oA = document.createElement('a');
            oA.className = 'item';
            oA.target = '_blank';
            oA.href = data[i].href || 'http://huydev.com';

            var oImg = document.createElement('img');
            oImg.src = data[i].src;

            oA.appendChild(oImg);
            parent.appendChild(oA);
            initGallery(parent, 'item');
        }
    }

}

function initGallery(parent, className){
    var aItems = getByClass(parent, className);
    var itemWidth = aItems[0].offsetWidth;
    var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    var num = Math.floor(w / itemWidth);
    var tmpW = num * (itemWidth + 10) + 'px';   // 10为margin值
    parent.style.cssText += ";width:" + tmpW + ";margin: 0 auto;";

    var colHeights = [];
    for(var i=0, len=aItems.length; i<len; i++){
        if(i < num){
            colHeights.push(aItems[i].offsetHeight + 10);
        }else{
            var mHeight = Math.min.apply({}, colHeights);
            var mIndex = getMinIndex(colHeights, mHeight);

            aItems[i].style.cssText = 'position:absolute;left:' + ((itemWidth+10) * mIndex) + 'px;top:' + mHeight + 'px;';
            colHeights[mIndex] += (aItems[i].offsetHeight + 10);
        }
    }
}


function getMinIndex(arr, minHeight){
    for(index in arr){
        if(arr[index] == minHeight)
            return index;
    }
}
function getByClass(parent, className){
    var arr = [];
    var p = parent || document;
    var aElem = p.getElementsByTagName('*');
    for(var i=0, len=aElem.length; i<len; i++){
        if(hasClass(aElem[i], className)){
            arr.push(aElem[i]);
        }
    }
    return arr;
}
function hasClass(elem, className){
    var names = elem.className.split(/\s+/);
    for(var i in names){
        if(names[i] == className)
            return true;
    }
    return false;
}

</script>
</body>
</html>